import{_ as i,c as a,o as e,a0 as n}from"./chunks/framework.MNVsvnY4.js";const c=JSON.parse('{"title":"Model Context Protocol (MCP)","description":"","frontmatter":{},"headers":[],"relativePath":"mpc/mpc.md","filePath":"3. MPC/MPC.md"}'),t={name:"mpc/mpc.md"};function l(h,s,r,o,p,k){return e(),a("div",null,s[0]||(s[0]=[n(`<h1 id="model-context-protocol-mcp" tabindex="-1">Model Context Protocol (MCP) <a class="header-anchor" href="#model-context-protocol-mcp" aria-label="Permalink to &quot;Model Context Protocol (MCP)&quot;">​</a></h1><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>The Model Context Protocol (MCP) is an open standard that enables seamless integration between AI models and external tools, data sources, and services. LlmTornado provides first-class support for MCP through the <code>LlmTornado.Mcp</code> adapter, allowing you to easily connect your applications to MCP servers and use their tools in your AI workflows.</p><h2 id="quick-start" tabindex="-1">Quick Start <a class="header-anchor" href="#quick-start" aria-label="Permalink to &quot;Quick Start&quot;">​</a></h2><p>Please see <a href="./gmail-mcp-server">https://github.com/GongRzhe/Gmail-MCP-Server</a> for more details on setting up OAuth</p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes vitesse-light dark-plus vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#2E8F82;--shiki-dark:#4EC9B0;">    MCPServer</span><span style="--shiki-light:#59873A;--shiki-dark:#9CDCFE;"> gmailServer</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#AB5959;--shiki-dark:#569CD6;"> new</span><span style="--shiki-light:#2E8F82;--shiki-dark:#4EC9B0;"> MCPServer</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">(</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#9CDCFE;">        serverLabel</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#CE9178;">gmail</span><span style="--shiki-light:#B5695977;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#9CDCFE;">        command</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#CE9178;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#CE9178;">npx</span><span style="--shiki-light:#B5695977;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#D4D4D4;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#9CDCFE;">        arguments</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">:</span><span style="--shiki-light:#AB5959;--shiki-dark:#569CD6;"> new</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">[]</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;"> {</span><span style="--shiki-light:#B5695977;--shiki-dark:#CE9178;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#CE9178;">@gongrzhe/server-gmail-autoauth-mcp</span><span style="--shiki-light:#B5695977;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;"> },</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#9CDCFE;">        allowedTools</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">:</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;"> [</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#CE9178;">            &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#CE9178;">read_email</span><span style="--shiki-light:#B5695977;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#D4D4D4;"> </span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#CE9178;">            &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#CE9178;">draft_email</span><span style="--shiki-light:#B5695977;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#D4D4D4;"> </span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#CE9178;">            &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#CE9178;">search_emails</span><span style="--shiki-light:#B5695977;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#569CD6;">    await</span><span style="--shiki-light:#B07D48;--shiki-dark:#9CDCFE;"> gmailServer</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#DCDCAA;">InitializeAsync</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">();</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#6A9955;"> // This will handle MCP Client connection to setup tools</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#2E8F82;--shiki-dark:#4EC9B0;">    TornadoAgent</span><span style="--shiki-light:#59873A;--shiki-dark:#9CDCFE;"> agent</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#AB5959;--shiki-dark:#569CD6;"> new</span><span style="--shiki-light:#2E8F82;--shiki-dark:#4EC9B0;"> TornadoAgent</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#9CDCFE;">        client</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#9CDCFE;">        model</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">:</span><span style="--shiki-light:#B07D48;--shiki-dark:#9CDCFE;"> ChatModel</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#9CDCFE;">OpenAi</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#9CDCFE;">Gpt41</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#9CDCFE;">V41Mini</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#9CDCFE;">        instructions</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#CE9178;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#CE9178;">You are a useful assistant for managing Gmail.</span><span style="--shiki-light:#B5695977;--shiki-dark:#CE9178;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">            );</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#9CDCFE;">    agent</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#DCDCAA;">AddMcpTools</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#9CDCFE;">gmailServer</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#9CDCFE;">AllowedTornadoTools</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#DCDCAA;">ToArray</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">());</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#6A9955;"> // Register MCP tools to the agent</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#2E8F82;--shiki-dark:#4EC9B0;">    Conversation</span><span style="--shiki-light:#59873A;--shiki-dark:#9CDCFE;"> result</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#AB5959;--shiki-dark:#569CD6;"> await</span><span style="--shiki-light:#B07D48;--shiki-dark:#9CDCFE;"> agent</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#DCDCAA;">RunAsync</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#CE9178;">Did mom respond?</span><span style="--shiki-light:#B5695977;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#9CDCFE;">    Console</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#DCDCAA;">WriteLine</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#9CDCFE;">result</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#9CDCFE;">Messages</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#DCDCAA;">Last</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">().</span><span style="--shiki-light:#B07D48;--shiki-dark:#9CDCFE;">Content</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">);</span></span></code></pre></div><h2 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to &quot;Best Practices&quot;">​</a></h2><h3 id="connection-management" tabindex="-1">Connection Management <a class="header-anchor" href="#connection-management" aria-label="Permalink to &quot;Connection Management&quot;">​</a></h3><ul><li>Properly dispose MCP clients using <code>await using</code> or try-finally blocks</li><li>Reuse MCP clients across multiple conversations when possible</li><li>Handle connection failures gracefully with retry logic</li><li>Monitor MCP server health and availability</li></ul><h3 id="tool-usage" tabindex="-1">Tool Usage <a class="header-anchor" href="#tool-usage" aria-label="Permalink to &quot;Tool Usage&quot;">​</a></h3><ul><li>Cache tool lists to avoid repeated discovery calls</li><li>Validate tool arguments before sending to MCP server</li><li>Provide clear error messages when tools fail</li><li>Log tool calls for debugging and monitoring</li></ul><h3 id="security" tabindex="-1">Security <a class="header-anchor" href="#security" aria-label="Permalink to &quot;Security&quot;">​</a></h3><ul><li>Validate MCP server endpoints before connecting</li><li>Use secure transports (TLS/SSL) for remote servers</li><li>Implement authentication when required</li><li>Sanitize tool inputs and outputs</li></ul><h3 id="performance" tabindex="-1">Performance <a class="header-anchor" href="#performance" aria-label="Permalink to &quot;Performance&quot;">​</a></h3><ul><li>Use streaming for long-running MCP operations</li><li>Implement timeouts for tool calls</li><li>Consider batching multiple tool calls when possible</li><li>Monitor and optimize tool execution times</li></ul><h2 id="common-issues" tabindex="-1">Common Issues <a class="header-anchor" href="#common-issues" aria-label="Permalink to &quot;Common Issues&quot;">​</a></h2><h3 id="issue-mcp-client-connection-fails" tabindex="-1">Issue: MCP Client Connection Fails <a class="header-anchor" href="#issue-mcp-client-connection-fails" aria-label="Permalink to &quot;Issue: MCP Client Connection Fails&quot;">​</a></h3><p><strong>Problem</strong>: Cannot connect to MCP server <strong>Solutions</strong>:</p><ul><li>Verify server is running and accessible</li><li>Check transport configuration (command, port, etc.)</li><li>Ensure correct protocol version compatibility</li><li>Review server logs for connection errors</li></ul><h3 id="issue-tools-not-appearing" tabindex="-1">Issue: Tools Not Appearing <a class="header-anchor" href="#issue-tools-not-appearing" aria-label="Permalink to &quot;Issue: Tools Not Appearing&quot;">​</a></h3><p><strong>Problem</strong>: <code>ListTornadoToolsAsync()</code> returns empty list <strong>Solutions</strong>:</p><ul><li>Verify MCP server has tools registered</li><li>Check server is properly initialized</li><li>Ensure tool schemas are valid</li><li>Review server tool configuration</li></ul><h3 id="issue-tool-execution-fails" tabindex="-1">Issue: Tool Execution Fails <a class="header-anchor" href="#issue-tool-execution-fails" aria-label="Permalink to &quot;Issue: Tool Execution Fails&quot;">​</a></h3><p><strong>Problem</strong>: <code>ResolveRemote()</code> throws exceptions <strong>Solutions</strong>:</p><ul><li>Validate tool arguments match schema</li><li>Check MCP server logs for errors</li><li>Ensure required dependencies are available</li><li>Implement proper error handling</li></ul><h3 id="issue-result-parsing-problems" tabindex="-1">Issue: Result Parsing Problems <a class="header-anchor" href="#issue-result-parsing-problems" aria-label="Permalink to &quot;Issue: Result Parsing Problems&quot;">​</a></h3><p><strong>Problem</strong>: Cannot extract tool results from MCP content <strong>Solutions</strong>:</p><ul><li>Check content block types (text, resource, etc.)</li><li>Handle all possible content block variants</li><li>Validate result structure matches expectations</li><li>Log raw MCP responses for debugging</li></ul><h2 id="api-reference" tabindex="-1">API Reference <a class="header-anchor" href="#api-reference" aria-label="Permalink to &quot;API Reference&quot;">​</a></h2><h3 id="extension-methods" tabindex="-1">Extension Methods <a class="header-anchor" href="#extension-methods" aria-label="Permalink to &quot;Extension Methods&quot;">​</a></h3><h4 id="listtornadotoolsasync" tabindex="-1">ListTornadoToolsAsync <a class="header-anchor" href="#listtornadotoolsasync" aria-label="Permalink to &quot;ListTornadoToolsAsync&quot;">​</a></h4><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes vitesse-light dark-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#569CD6;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#569CD6;"> static</span><span style="--shiki-light:#AB5959;--shiki-dark:#569CD6;"> async</span><span style="--shiki-light:#2E8F82;--shiki-dark:#4EC9B0;"> Task</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#2E8F82;--shiki-dark:#4EC9B0;">List</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#2E8F82;--shiki-dark:#4EC9B0;">Tool</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">&gt;&gt;</span><span style="--shiki-light:#59873A;--shiki-dark:#DCDCAA;"> ListTornadoToolsAsync</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#569CD6;">this</span><span style="--shiki-light:#2E8F82;--shiki-dark:#4EC9B0;"> IMcpClient</span><span style="--shiki-light:#59873A;--shiki-dark:#9CDCFE;"> client</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">)</span></span></code></pre></div><p>Fetches all tools from the MCP server and converts them to LlmTornado Tool objects.</p><h4 id="resolveremote" tabindex="-1">ResolveRemote <a class="header-anchor" href="#resolveremote" aria-label="Permalink to &quot;ResolveRemote&quot;">​</a></h4><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes vitesse-light dark-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#569CD6;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#569CD6;"> static</span><span style="--shiki-light:#AB5959;--shiki-dark:#569CD6;"> async</span><span style="--shiki-light:#2E8F82;--shiki-dark:#4EC9B0;"> Task</span><span style="--shiki-light:#59873A;--shiki-dark:#DCDCAA;"> ResolveRemote</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#569CD6;">this</span><span style="--shiki-light:#2E8F82;--shiki-dark:#4EC9B0;"> FunctionCall</span><span style="--shiki-light:#59873A;--shiki-dark:#9CDCFE;"> call</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">,</span><span style="--shiki-light:#1E754F;--shiki-dark:#569CD6;"> object</span><span style="--shiki-light:#59873A;--shiki-dark:#9CDCFE;"> arguments</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">)</span></span></code></pre></div><p>Executes a function call on the remote MCP server.</p><h3 id="mcp-server-configuration" tabindex="-1">MCP Server Configuration <a class="header-anchor" href="#mcp-server-configuration" aria-label="Permalink to &quot;MCP Server Configuration&quot;">​</a></h3><h4 id="mcpserver-class" tabindex="-1">MCPServer Class <a class="header-anchor" href="#mcpserver-class" aria-label="Permalink to &quot;MCPServer Class&quot;">​</a></h4><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes vitesse-light dark-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#569CD6;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#569CD6;"> class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#4EC9B0;"> MCPServer</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">{</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#569CD6;">    public</span><span style="--shiki-light:#59873A;--shiki-dark:#DCDCAA;"> MCPServer</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#2E8F82;--shiki-dark:#4EC9B0;">IMcpClient</span><span style="--shiki-light:#59873A;--shiki-dark:#9CDCFE;"> client</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#DCDCAA;">    public</span><span style="--shiki-light:#59873A;--shiki-dark:#DCDCAA;"> IMcpClient</span><span style="--shiki-light:#59873A;--shiki-dark:#DCDCAA;"> Client</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;"> {</span><span style="--shiki-light:#B07D48;--shiki-dark:#9CDCFE;"> get</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">;</span><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;"> }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#D4D4D4;">}</span></span></code></pre></div><h3 id="mcp-content-types" tabindex="-1">MCP Content Types <a class="header-anchor" href="#mcp-content-types" aria-label="Permalink to &quot;MCP Content Types&quot;">​</a></h3><ul><li><code>McpContent</code> - Container for MCP content blocks</li><li><code>McpContentBlockText</code> - Text content block</li><li><code>McpContentBlockResource</code> - Resource reference block</li><li><code>McpContentBlockImage</code> - Image content block</li></ul><h2 id="related-topics" tabindex="-1">Related Topics <a class="header-anchor" href="#related-topics" aria-label="Permalink to &quot;Related Topics&quot;">​</a></h2><ul><li><a href="./../1. LlmTornado/1. Chat/4. functions">Function Calling</a> - Learn about LlmTornado&#39;s function calling system</li><li><a href="./../2. Agents/2. Tornado-Agent/4. Tools/3. MCP Tools">Tornado Agent Tools</a> - Using MCP tools with agents</li><li><a href="https://modelcontextprotocol.io/" target="_blank" rel="noreferrer">Official MCP Documentation</a> - Learn more about the MCP standard</li><li><a href="https://github.com/modelcontextprotocol/dotnet-sdk" target="_blank" rel="noreferrer">MCP .NET SDK</a> - Official .NET SDK for MCP</li></ul>`,43)]))}const g=i(t,[["render",l]]);export{c as __pageData,g as default};
